{"version":3,"sources":["block_accessinfo.js"],"names":["define","$","templates","cfg","common","panel","getPanel","panelBody","table","loader","accessDesc","init","invalidUser","length","show","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","done","response","error","exception","errorcode","render","getTemplate","then","html","js","replaceNodeContents","fail","ex","console","log","always","remove","removeClass","tooltip","hide"],"mappings":"AAAA,aA0BAA,OAAO,CAAC,SAAU,iBAAkB,qCAAsC,YAAa,SAAUC,EAAGC,EAAWC,EAAKC,GAClH,IAAIC,EAAQF,EAAIG,SAAS,oBACrBC,EAAYJ,EAAIG,SAAS,mBAAoB,QAC7CE,EAAQL,EAAIG,SAAS,mBAAoB,SACzCG,EAASN,EAAIG,SAAS,mBAAoB,UAC1CI,EAAa,uBAsDjB,MAAO,CACLC,KAjDF,SAAcC,GAONX,EAAEI,GAAOQ,SAEXT,EAAOK,OAAOK,KAAK,oBACnBb,EAAEc,KAAK,CACLC,IAAKb,EAAIc,WACTC,KAAMf,EAAIgB,YACVC,SAAUjB,EAAIkB,gBACdC,KAAM,CACJC,OAAQ,2BACRC,OAAQC,EAAEC,qBAAqBF,UAEhCG,KAAK,SAAUC,IACO,IAAnBA,EAASC,OAAmD,qBAAjCD,EAASE,UAAUC,UAMlD7B,EAAU8B,OAAO7B,EAAI8B,YAAY,mBAAoBL,EAASN,MAAMY,KAAK,SAAUC,EAAMC,GACvFlC,EAAUmC,oBAAoB9B,EAAW4B,EAAMC,KAE9CE,KAAK,SAAUC,GAChBC,QAAQC,IAAIF,KACXG,OAAO,WACRzC,EAAES,GAAYI,OACdb,EAAEQ,GAAQkC,SACV1C,EAAEO,GAAOoC,YAAY,UACrB3C,EAAEI,EAAQ,4BAA4BwC,UAEtCzC,EAAOK,OAAOqC,KAAK,sBAhBnBlC,EAAY,kBAAmBgB,KAkBhCU,KAAK,SAAUT,MACfa,OAAO,WAERtC,EAAOK,OAAOqC,KAAK","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-console */\ndefine([\n    'jquery',\n    'core/templates',\n    'local_edwiserreports/defaultconfig',\n    './common'\n], function($, templates, cfg, common) {\n    var panel = cfg.getPanel(\"#siteaccessblock\");\n    var panelBody = cfg.getPanel(\"#siteaccessblock\", \"body\");\n    var table = cfg.getPanel(\"#siteaccessblock\", \"table\");\n    var loader = cfg.getPanel(\"#siteaccessblock\", \"loader\");\n    var accessDesc = \"#accessinfodesctable\";\n\n    /**\n     * Initialize\n     * @param {function} invalidUser Callback function\n     */\n    function init(invalidUser) {\n        generateAccessInfoGraph();\n\n        /**\n         * Generate access info graph\n         */\n        function generateAccessInfoGraph() {\n\n            if ($(panel).length) {\n                // Show loader.\n                common.loader.show('#siteaccessblock');\n                $.ajax({\n                    url: cfg.requestUrl,\n                    type: cfg.requestType,\n                    dataType: cfg.requestDataType,\n                    data: {\n                        action: 'get_siteaccess_data_ajax',\n                        secret: M.local_edwiserreports.secret\n                    },\n                })\n                .done(function(response) {\n                    if (response.error === true && response.exception.errorcode === 'invalidsecretkey') {\n                        invalidUser('siteaccessblock', response);\n                        return;\n                    }\n                    // eslint-disable-next-line promise/catch-or-return\n                    templates.render(cfg.getTemplate(\"siteaccessblock\"), response.data)\n                    .then(function(html, js) {\n                        templates.replaceNodeContents(panelBody, html, js);\n                        return;\n                    })\n                    .fail(function(ex) {\n                        console.log(ex);\n                    })\n                    .always(function() {\n                        $(accessDesc).show();\n                        $(loader).remove();\n                        $(table).removeClass(\"d-none\");\n                        $(panel + ' [data-toggle=\"tooltip\"]').tooltip();\n\n                        // Hide loader.\n                        common.loader.hide('#siteaccessblock');\n                    });\n                })\n                .fail(function(error) {\n                    // console.log(error);\n                }).always(function() {\n                    // Hide loader.\n                    common.loader.hide('#siteaccessblock');\n                });\n            }\n        }\n    }\n\n    // Must return the init function\n    return {\n        init: init\n    };\n});\n"],"file":"block_accessinfo.min.js"}