"use strict";define(["jquery","core/chartjs","core/notification","./defaultconfig","./variables","./common","./flatpickr"],function(e,o,t,r,a,l){var n=null,i=null,s=r.getPanel("#activeusersblock"),d=r.getPanel("#activeusersblock","body"),c=(r.getPanel("#activeusersblock","title"),r.getPanel("#activeusersblock","footer")),p=s+" .dropdown-menu[aria-labelledby='filter-dropdown']:not('custom')",u=p+" .dropdown-item",h=s+" #filter-dropdown.dropdown-toggle",g=s+" #flatpickrCalender",m=d+" .ct-chart",f=d+" .loader",b=s+" button#filter-dropdown",C=d+" .refresh",v=s+a.exportUrlLink,y=null,k=d+" input.form-control.input";return{init:function(s){function w(a){e(m).hide(),e(f).show(),a||(a="weekly"),l.loader.show("#activeusersblock"),e.ajax({url:r.requestUrl,type:r.requestType,dataType:r.requestDataType,data:{action:"get_activeusers_graph_data_ajax",secret:M.local_edwiserreports.secret,data:JSON.stringify({precalculated:-1!==["weekly","monthly","yearly"].indexOf(a),filter:a})}}).done(function(e){!0!==e.error||"invalidsecretkey"!==e.exception.errorcode?(n.graph.data=e.data,n.graph.labels=e.labels):s("activeusersblock",e)}).fail(function(e){t.exception(e)}).always(function(){i&&i.destroy(),o.defaults.global.defaultFontFamily=n.graph.fontFamily,o.defaults.global.defaultFontStyle=n.graph.fontStyle,i=i=new o(n.ctx,{type:n.graph.type,data:U(),options:n.graph.options}),e(c).find('.download-links input[name="filter"]').val(a),e(d+" #updated-time > span.minute").html(0),setInterval(x,6e4),e(C).removeClass("refresh-spin"),e(f).hide(),e(m).fadeIn("slow"),l.loader.hide("#activeusersblock")})}function x(){e(d+" #updated-time > span.minute").html(parseInt(e(d+" #updated-time > span.minute").text())+1)}function U(){try{return{labels:n.graph.labels,datasets:[{label:n.graph.labelName.activeUsers,data:n.graph.data.activeUsers,backgroundColor:n.graph.backgroundColor.activeUsers,borderColor:n.graph.borderColor.activeUsers,pointBorderColor:n.graph.borderColor.activeUsers,pointBackgroundColor:n.graph.borderColor.activeUsers,pointStyle:n.graph.pointStyle},{label:n.graph.labelName.enrolments,data:n.graph.data.enrolments,backgroundColor:n.graph.backgroundColor.enrolments,borderColor:n.graph.borderColor.enrolments,pointBorderColor:n.graph.borderColor.enrolments,pointBackgroundColor:n.graph.borderColor.enrolments,pointStyle:n.graph.pointStyle},{label:n.graph.labelName.completionRate,data:n.graph.data.completionRate,backgroundColor:n.graph.backgroundColor.completionRate,borderColor:n.graph.borderColor.completionRate,pointBorderColor:n.graph.borderColor.completionRate,pointBackgroundColor:n.graph.borderColor.completionRate,pointStyle:n.graph.pointStyle}]}}catch(e){return{}}}(n=r.getActiveUsersBlock())&&(e(h).on("click",function(){e(p).addClass("show")}),e(k).ready(function(){var o=e(k).attr("placeholder");e(k).val(o)}),e(document).click(function(o){e(o.target).hasClass("dropdown-menu")||e(o.target).parents(".dropdown-menu").length||e(p).removeClass("show")}),e(u+":not(.custom)").on("click",function(){y=e(this).attr("value"),e(p).removeClass("show"),e(b).html(e(this).text()),w(y),e(g).val("Custom"),e(k).val("Custom")}),e(C).on("click",function(){e(this).addClass("refresh-spin"),w(y)}),e(g).flatpickr({mode:"range",altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",maxDate:"today",appendTo:document.getElementById("activeUser-calendar"),onOpen:function(){e(p).addClass("withcalendar")},onClose:function(){e(p).removeClass("withcalendar"),e(p).removeClass("show"),function(){y=e(g).val();var o=e(k).val();y.includes("to")&&(r.changeExportUrl(y,v,a.filterReplaceFlag),e(b).html(o),e(g).val(""),w(y))}()}}),w())}}});
//# sourceMappingURL=block_activeusers.min.js.map
